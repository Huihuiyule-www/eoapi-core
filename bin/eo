#!/usr/bin/env node
const fs = require('fs')
const path = require('path')
const packageJson = require('../package.json')
const commander = require('commander')

commander.version(packageJson.version)

commander
  .command('g <target>')
  .description('Create a plugin template.')
  .action(async (target) => {
    const mainTemplate = fs.readFileSync(
      path.join(__dirname, '../template/index.js'),
      {
        encoding: 'utf8'
      }
    )
    const packageTemplate = fs.readFileSync(
      path.join(__dirname, '../template/package.json'),
      {
        encoding: 'utf8'
      }
    )
    const _path = path.join(process.cwd(), target)
    fs.mkdirSync(`${_path}`)
    fs.writeFileSync(`${_path}/index.js`, mainTemplate)
    console.log(`${_path}/index.js is generated. `)
    fs.writeFileSync(`${_path}/package.json`, packageTemplate)
    console.log(`${_path}/package.json is generated. `)
  })

// * parse args in commander
commander.parse(process.argv)
